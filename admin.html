<!DOCTYPE html>
<html>
<head><title>Admin Page</title><link rel="stylesheet" href="styles.css"></head>
<body>
  <script>
    // Check if the user is logged in and is an admin
    if (!localStorage.getItem('isLoggedIn') || localStorage.getItem('userRole') !== 'admin') {
      window.location.href = 'index.html';
    }
  </script>
<nav>
  <a href="index.html">Home</a>
</nav>

<h1>Admin Dashboard</h1>

<h2>Add New Book</h2>
<input id="title" placeholder="Title"><br>
<input id="author" placeholder="Author"><br>
<select id="genre">
  <option>Fiction</option>
  <option>Non-Fiction</option>
  <option>Romance</option>
  <option>Mystery</option>
  <option>Sci-Fi</option>
</select><br>
<button onclick="addBook()">Add Book</button>

<div id="message"></div>

<h2>All Books</h2>
<div id="book-list"></div>

<script>
// Load and display books
function loadBooks() {
  fetch('/api/books')
    .then(res => res.json())
    .then(data => {
      const list = document.getElementById('book-list');
      list.innerHTML = '';
      data.forEach(book => {
        const div = document.createElement('div');
div.className = 'book';
div.innerHTML = `
  <h3>${book.title}</h3>
  <p>${book.author} | ${book.genre}</p>
  <button onclick="deleteBook(${book.id})">Delete</button>`
;
        list.appendChild(div);
    })  ;
    });
}

// Add new book
function addBook() {
  const title = document.getElementById('title').value;
  const author = document.getElementById('author').value;
  const genre = document.getElementById('genre').value;

  fetch('/api/addbook', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title, author, genre })
  })
  .then(res => res.json())
  .then(result => {
    if (result.success) {
      document.getElementById('message').innerText = 'Book added!';
      document.getElementById('title').value = '';
      document.getElementById('author').value = '';
      document.getElementById('genre').selectedIndex = 0;
      loadBooks();
    } else {
      document.getElementById('message').innerText = 'Failed to add book';
    }
  });
}

// Delete book
function deleteBook(id) {
  fetch(`/api/deletebook/${id}`,
   { method: 'DELETE' })
    .then(res => res.json())
    .then(result => {
      if (result.success) {
        loadBooks();
      } else {
        alert('Failed to delete');
      }
    });
}

loadBooks();
</script>

</body>
</html>